# üóÑÔ∏è Alembic Database Migrations

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
alembic/
‚îú‚îÄ‚îÄ env.py                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ script.py.mako           # –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
‚îî‚îÄ‚îÄ versions/                # –ü–∞–ø–∫–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
    ‚îî‚îÄ‚îÄ 001_initial_migration.py  # –ù–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

alembic.ini                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
migrate.py                   # –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1Ô∏è‚É£ **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
```bash
pip install alembic
```

### 2Ô∏è‚É£ **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
```bash
python migrate.py upgrade
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î:
- `user` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏/—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
- `menu_item` - –±–ª—é–¥–∞ –≤ –º–µ–Ω—é
- `restaurant_table` - —Å—Ç–æ–ª—ã
- `order` - –∑–∞–∫–∞–∑—ã
- `order_item` - –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤

### 3Ô∏è‚É£ **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä**
```bash
uvicorn main:app --reload
```

## üìù –ö–æ–º–∞–Ω–¥—ã –º–∏–≥—Ä–∞—Ü–∏–π

### –û–±–Ω–æ–≤–∏—Ç—å –ë–î –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é
```bash
python migrate.py upgrade
```

### –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
```bash
python migrate.py downgrade
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
```bash
python migrate.py current
```

### –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
```bash
python migrate.py history
```

## ‚ú® –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π)
```bash
alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
```

### –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
```bash
alembic revision -m "–Ω–∞–∑–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏"
```

–ü–æ—Ç–æ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –≤ `alembic/versions/`

## üîÑ –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î

–¢–µ–ø–µ—Ä—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î, –∞ –Ω–µ –ª–æ–∫–∞–ª—å–Ω–æ:

‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏/–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏** - —Ç–∞–±–ª–∏—Ü–∞ `user`
‚úÖ **–ë–ª—é–¥–∞ –º–µ–Ω—é** - —Ç–∞–±–ª–∏—Ü–∞ `menu_item`  
‚úÖ **–°—Ç–æ–ª—ã** - —Ç–∞–±–ª–∏—Ü–∞ `restaurant_table`
‚úÖ **–ó–∞–∫–∞–∑—ã** - —Ç–∞–±–ª–∏—Ü–∞ `order`
‚úÖ **–ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤** - —Ç–∞–±–ª–∏—Ü–∞ `order_item`

## üîó –°–≤—è–∑–∏ –≤ –ë–î

```
order.table_id ‚Üí restaurant_table.id
order_item.order_id ‚Üí order.id
order_item.menu_item_id ‚Üí menu_item.id
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### "No such table" –æ—à–∏–±–∫–∞
‚Üí –í—ã–ø–æ–ª–Ω–∏—Ç–µ: `python migrate.py upgrade`

### "Already exists" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã
‚Üí –û—Ç–∫–∞—Ç–∏—Ç–µ: `python migrate.py downgrade`

### –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞—Å—Ç—Ä—è–ª–∞
‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `python migrate.py current`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Alembic –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://alembic.sqlalchemy.org/)
- [SQLAlchemy ORM](https://docs.sqlalchemy.org/)
- [–ù–∞—à –∫–æ–Ω—Ñ–∏–≥ –ë–î](app/config.py)
